<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>readstata13: Basic Manual • readstata13</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="readstata13: Basic Manual">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">readstata13</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/readstata13_basic_manual.html">readstata13: Basic Manual</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sjewo/readstata13/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>readstata13: Basic Manual</h1>
                        <h4 data-toc-skip class="author">Jan Marvin
Garbuszus &amp; Sebastian Jeworutzki</h4>
            
            <h4 data-toc-skip class="date">2025-04-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sjewo/readstata13/blob/main/vignettes/readstata13_basic_manual.Rmd" class="external-link"><code>vignettes/readstata13_basic_manual.Rmd</code></a></small>
      <div class="hidden name"><code>readstata13_basic_manual.Rmd</code></div>

    </div>

    
    
<p>Due to changes in the Stata 13 dta file format, former import methods
using the <code>foreign</code> package no longer work with files created
by Stata releases after version 12. Starting with Stata 13, the dta
format resembles XML files.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Portions of the content are structured like
XML nodes, e.g., <code>&lt;N&gt;1&lt;/N&gt;</code> could represent the
number of observations in the dta file. Since neither of us, my friend
and former colleague Sebastian Jeworutzki co-authored the package, knew
much about writing C code, and I was experimenting with Rcpp at the
time, we decided to create what has since become a sort of Swiss Army
knife for handling dta files in R. Among its many features are:</p>
<ul>
<li>Importing dta files of all previously known and many unknown and
undocumented file formats. This includes both reading and writing of the
mentioned files.</li>
<li>Handling many dta features like string encoding, multilingual
labels, business calendars, long strings (called strL), frames and even
embedded binary data.</li>
</ul>
<p>Created as a drop-in replacement for <code>foreign</code>’s dta
reading, we included many additional features to improve label handling
(label generation) and partial reading to read only selected rows or
variables.</p>
<div class="section level2">
<h2 id="basics-reading-and-writing-stata-files">Basics: Reading and Writing Stata files<a class="anchor" aria-label="anchor" href="#basics-reading-and-writing-stata-files"></a>
</h2>
<p>Similar to <code>foreign</code>, you can use <code>read.dta13</code>
to import a file.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span> <span class="op">(</span><span class="va">cars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save file cars.dta</span></span>
<span><span class="fu"><a href="../reference/save.dta13.html">save.dta13</a></span><span class="op">(</span><span class="va">cars</span>, file <span class="op">=</span> <span class="st">"res/cars.dta"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read file cars.dta</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="st">"res/cars.dta"</span><span class="op">)</span></span></code></pre></div>
<p>While often only the imported data is of interest to the user,
additional information is available in the attributes of the imported
file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prints the attributes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; $row.names</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25</span></span>
<span><span class="co">#&gt; [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $names</span></span>
<span><span class="co">#&gt; [1] "speed" "dist" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $class</span></span>
<span><span class="co">#&gt; [1] "data.frame"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $datalabel</span></span>
<span><span class="co">#&gt; [1] "Written by R"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $time.stamp</span></span>
<span><span class="co">#&gt; [1] "24 Apr 2025 20:59"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $formats</span></span>
<span><span class="co">#&gt; [1] "%9.0g" "%9.0g"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $types</span></span>
<span><span class="co">#&gt; [1] 65526 65526</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $val.labels</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; "" "" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $var.labels</span></span>
<span><span class="co">#&gt; [1] "" ""</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $version</span></span>
<span><span class="co">#&gt; [1] 117</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $label.table</span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $expansion.fields</span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $byteorder</span></span>
<span><span class="co">#&gt; [1] "LSF"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $orig.dim</span></span>
<span><span class="co">#&gt; [1] 50  2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data.label</span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre></div>
<p>It is easy to see that this file was created using format 117, which
was implemented in Stata 13 and can be processed by all later versions
of Stata. The attributes include the data label, a string that Stata
users can see, a timestamp, and formats and types needed to represent
the data in Stata. In this case, the <code>save.dta13</code> function
used binary <code>double</code>s to write the data because the data type
in R is <code>numeric</code>. The byte order refers to endianness. This
file was created with Little Endian, but <code>read.dta13</code> handles
reads and writes for both endianness types.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>The read and write functions take care of the conversion of missing
values, value labels, and variable labels.</p>
</div>
<div class="section level2">
<h2 id="supported-stata-versions">Supported Stata Versions<a class="anchor" aria-label="anchor" href="#supported-stata-versions"></a>
</h2>
<p>Since we were forced to write our own dta-file reader, we made sure
that we could write files that were readable by earlier versions of
Stata. This can be achieved with the <code>version</code> argument in
<code>save.dta13</code>. Available versions are:</p>
<table class="table">
<thead><tr class="header">
<th>version</th>
<th>format</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>18 - 19</td>
<td>121</td>
</tr>
<tr class="even">
<td>18 - 19</td>
<td>120</td>
</tr>
<tr class="odd">
<td>15 - 19</td>
<td>119</td>
</tr>
<tr class="even">
<td>14 - 19</td>
<td>118</td>
</tr>
<tr class="odd">
<td>13</td>
<td>117</td>
</tr>
<tr class="even">
<td>12</td>
<td>115</td>
</tr>
<tr class="odd">
<td>10 - 11</td>
<td>114</td>
</tr>
<tr class="even">
<td>8 - 9</td>
<td>113</td>
</tr>
<tr class="odd">
<td>7</td>
<td>110</td>
</tr>
<tr class="even">
<td>6</td>
<td>108</td>
</tr>
</tbody>
</table>
<p>These are only the versions and formats that users are most likely to
find. We support any format that is included in Stata versions. The
minimum format we support is <code>102</code> (Stata 1), and the maximum
is <code>121</code> (Files with more than 32,767 variables. Those are
only readable by Stata 18 &amp; 19 MP.).<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> Over the years, the
format has changed to allow more observations (sometimes introduced in
SE and MP releases of Stata), longer strings, variable names, labels,
etc. We support reading any file format, although we currently have no
control over Stata’s limits. If you do not want to experiment or are
unsure if your data will fit in the specific version of Stata you are
targeting, it is a good idea not to choose versions &lt; 7 or formats
&lt; 110, which is the default in <code><a href="https://rdrr.io/pkg/foreign/man/write.dta.html" class="external-link">foreign::write.dta</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save a Stata 7 dta file</span></span>
<span><span class="fu"><a href="../reference/save.dta13.html">save.dta13</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"res/cars_version.dta"</span>, version <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read this file and print the format</span></span>
<span><span class="va">dat3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="st">"res/cars_version.dta"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">dat3</span>, <span class="st">"version"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 110</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="working-with-labelled-data">Working with Labelled Data<a class="anchor" aria-label="anchor" href="#working-with-labelled-data"></a>
</h2>
<p>Stata datasets contain metadata such as variable or value labels.
Since base R doesn’t support labelled data, this information is stored
in different attributes of the data.frame returned by
<code>read.stata13</code>. These data.frames have the same attributes as
those from the <code>read.dta</code> function in the
<code>foreign</code> package.</p>
<p>For this example, we use the Stata file “statacar.dta” provided with
the <code>readstata13</code> package. We disable the conversion of
factors and start with numeric codes for categorical data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sjewo/readstata13" class="external-link">readstata13</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/statacar.dta"</span>, package <span class="op">=</span> <span class="st">"readstata13"</span><span class="op">)</span>,</span>
<span>                convert.factors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Variable labels are stored in the <code>var.labels</code>
attribute.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"var.labels"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Numeric ID"             "Brand of car"           "Car model"             </span></span>
<span><span class="co">#&gt;  [4] "Car classification"     "Horse Power"            "Maximum speed"         </span></span>
<span><span class="co">#&gt;  [7] ""                       ""                       "Launch date"           </span></span>
<span><span class="co">#&gt; [10] "Launch date (calendar)" ""</span></span></code></pre></div>
<p>Labels for a single variable might be retrieved using the
<code><a href="../reference/varlabel.html">varlabel()</a></code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/varlabel.html">varlabel</a></span><span class="op">(</span><span class="va">x</span>, var.name <span class="op">=</span> <span class="st">"type"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 type </span></span>
<span><span class="co">#&gt; "Car classification"</span></span></code></pre></div>
<p>The information about value labels is stored in a more complex way.
The <code>val.labels</code> attribute defines a label table for each
column, which provides the codes and labels for a single variable. These
label tables are stored as a list in the <code>label.table</code>
attribute.</p>
<p>The example dataset has only one column with labelled values.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"val.labels"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                 type_en                                         </span></span>
<span><span class="co">#&gt;        ""        ""        "" "type_en"        ""        ""        ""        "" </span></span>
<span><span class="co">#&gt;                               </span></span>
<span><span class="co">#&gt;        ""        ""        ""</span></span></code></pre></div>
<p>The corresponding label table for the fourth column is called
<code>type_en</code>. This is a vector of numeric codes, and the labels
are provided by the element names.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"label.table"</span><span class="op">)</span><span class="op">$</span><span class="va">type_en</span></span>
<span><span class="co">#&gt;         min    Off-Road    Roadster    City car  Family car         max </span></span>
<span><span class="co">#&gt; -2147483647           1           2           3           4  2147483620</span></span></code></pre></div>
<p>The function <code><a href="../reference/get.label.name.html">get.label.name()</a></code> and
<code><a href="../reference/get.label.html">get.label()</a></code> will provide the same results.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get.label.name.html">get.label.name</a></span><span class="op">(</span><span class="va">x</span>, var.name <span class="op">=</span> <span class="st">"type"</span><span class="op">)</span></span>
<span><span class="co">#&gt;      type </span></span>
<span><span class="co">#&gt; "type_en"</span></span>
<span><span class="fu"><a href="../reference/get.label.html">get.label</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"type_en"</span><span class="op">)</span></span>
<span><span class="co">#&gt;         min    Off-Road    Roadster    City car  Family car         max </span></span>
<span><span class="co">#&gt; -2147483647           1           2           3           4  2147483620</span></span></code></pre></div>
<p>Labels are most often used to create the levels of a factor variable.
<code>readstata13</code> provides a command to simplify this process.
<code><a href="../reference/set.label.html">set.label()</a></code> returns a factor using the stored labels.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create factor from variable "type"</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">type_en</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set.label.html">set.label</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"type"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="va">x</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"type"</span>, <span class="st">"type_en"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;          type    type_en</span></span>
<span><span class="co">#&gt; 1           2   Roadster</span></span>
<span><span class="co">#&gt; 2           4 Family car</span></span>
<span><span class="co">#&gt; 3           3   City car</span></span>
<span><span class="co">#&gt; 4           4 Family car</span></span>
<span><span class="co">#&gt; 5           1   Off-Road</span></span>
<span><span class="co">#&gt; 6           3   City car</span></span>
<span><span class="co">#&gt; 7  2147483620        max</span></span>
<span><span class="co">#&gt; 8 -2147483647        min</span></span></code></pre></div>
<div class="section level3">
<h3 id="multi-language-support">Multi Language Support<a class="anchor" aria-label="anchor" href="#multi-language-support"></a>
</h3>
<p>Since Stata supports multi-language files, labels can be provided in
different languages. The <code>lang</code> option in
<code><a href="../reference/set.label.html">set.label()</a></code> allows you to choose labels for a specific
language.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show available and default language </span></span>
<span><span class="fu"><a href="../reference/get.lang.html">get.lang</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; Available languages:</span></span>
<span><span class="co">#&gt;  en</span></span>
<span><span class="co">#&gt;  de</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Default language:</span></span>
<span><span class="co">#&gt;  en</span></span>
<span></span>
<span><span class="co"># Create factor with German labels</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">type_de</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set.label.html">set.label</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"type"</span>, lang <span class="op">=</span> <span class="st">"de"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="va">x</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"type"</span>, <span class="st">"type_en"</span>, <span class="st">"type_de"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;          type    type_en      type_de</span></span>
<span><span class="co">#&gt; 1           2   Roadster   Sportwagen</span></span>
<span><span class="co">#&gt; 2           4 Family car Familienauto</span></span>
<span><span class="co">#&gt; 3           3   City car    Stadtauto</span></span>
<span><span class="co">#&gt; 4           4 Family car Familienauto</span></span>
<span><span class="co">#&gt; 5           1   Off-Road Geländewagen</span></span>
<span><span class="co">#&gt; 6           3   City car    Stadtauto</span></span>
<span><span class="co">#&gt; 7  2147483620        max          max</span></span>
<span><span class="co">#&gt; 8 -2147483647        min          min</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compability-with-other-packages">Compability with other Packages<a class="anchor" aria-label="anchor" href="#compability-with-other-packages"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># version &gt; 2.8.0 is needed due to a bug in to_label</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://larmarange.github.io/labelled/" class="external-link">labelled</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">xl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/statacar.dta"</span>, package <span class="op">=</span> <span class="st">"readstata13"</span><span class="op">)</span>,</span>
<span>                convert.factors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://larmarange.github.io/labelled/reference/to_labelled.html" class="external-link">to_labelled</a></span><span class="op">(</span><span class="va">xl</span><span class="op">)</span></span>
<span><span class="va">xl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 11</span></span></span>
<span><span class="co">#&gt;      id brand   model    type     hp         max  mileage  ecar ldate ldatecal  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Meyer   Spee…  2   <span style="color: #949494;">e</span>0    150    1.77<span style="color: #949494;">e</span>  2  1.02<span style="color: #949494;">e</span> 1     0     1 2001-01-03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 Meyer   Happ…  4   <span style="color: #949494;">e</span>0     98    1.45<span style="color: #949494;">e</span>  2  5.60<span style="color: #949494;">e</span> 0     0   247 2001-12-31</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 Akiko   Susu…  3   <span style="color: #949494;">e</span>0     45    1.19<span style="color: #949494;">e</span>  2 <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>       0    14 2001-01-23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 Akiko   Susu…  4   <span style="color: #949494;">e</span>0     80    1.27<span style="color: #949494;">e</span>  2  6.80<span style="color: #949494;">e</span> 0     0   134 2001-07-16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 Hutch   Lumb…  1   <span style="color: #949494;">e</span>0    180    1.56<span style="color: #949494;">e</span>  2  1.42<span style="color: #949494;">e</span> 1     0   110 2001-06-11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6 Erikson E-Ca…  3   <span style="color: #949494;">e</span>0     <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>       1   100 2001-05-25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>     7 Erikson Maxi…  2.15<span style="color: #949494;">e</span>9  <span style="text-decoration: underline;">32</span>740    8.99<span style="color: #949494;">e</span>307  1.70<span style="color: #949494;">e</span>38   100    19 2001-01-30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>     7 Erikson Mimi… -<span style="color: #BB0000;">2.15</span><span style="color: #949494;">e</span>9 -<span style="color: #BB0000; text-decoration: underline;">32</span><span style="color: #BB0000;">767</span> -<span style="color: #BB0000;">Inf</span>   <span style="color: #949494;"> </span>    -<span style="color: #BB0000;">1.70</span><span style="color: #949494;">e</span>38  -<span style="color: #BB0000;">127</span>     1 2001-01-03</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: modelStrL &lt;chr&gt;</span></span></span></code></pre></div>
<p>Packages like <code>expss</code> use the stored labels to produce
descriptive headers in tables or to label the axes of a graph.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gdemin.github.io/expss/" class="external-link">expss</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: maditr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To select columns from data: columns(mtcars, mpg, vs:carb)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use 'expss_output_viewer()' to display tables in the RStudio Viewer.</span></span>
<span><span class="co">#&gt;  To return to the console output, use 'expss_output_default()'.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'expss'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:labelled':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     is.labelled</span></span>
<span><span class="co">#xl &lt;- add_labelled_class(xl) </span></span>
<span></span>
<span><span class="co"># set negative hp values to na</span></span>
<span><span class="va">xl</span><span class="op">[</span><span class="va">xl</span><span class="op">$</span><span class="va">hp</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">xl</span><span class="op">$</span><span class="va">hp</span><span class="op">)</span>, <span class="st">"hp"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">xl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/expss/man/tables.html" class="external-link">tab_cells</a></span><span class="op">(</span><span class="va">hp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/expss/man/tables.html" class="external-link">tab_cols</a></span><span class="op">(</span><span class="va">brand</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/expss/man/tables.html" class="external-link">tab_stat_mean_sd_n</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/expss/man/tables.html" class="external-link">tab_pivot</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/expss/man/set_caption.html" class="external-link">set_caption</a></span><span class="op">(</span><span class="st">"Horse power by car brand."</span><span class="op">)</span></span></code></pre></div>
<table class="table gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<td colspan="5" style="text-align: left;">
Horse power by car brand.
</td>
</tr>
<tr>
<th style="border-top: 2px solid grey;">
</th>
<th colspan="4" style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
 Brand of car 
</th>
</tr>
<tr>
<th style="border-bottom: 1px solid grey; font-weight: 900; text-align: center;">
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; text-align: center;">
 Akiko 
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; text-align: center;">
 Erikson 
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; text-align: center;">
 Hutch 
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; text-align: center;">
 Meyer 
</th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="5" style="font-weight: 900;">
 Horse Power 
</td>
</tr>
<tr>
<td style="text-align: left;">
   Mean 
</td>
<td style="text-align: right;">
62.5
</td>
<td style="text-align: right;">
32740
</td>
<td style="text-align: right;">
180
</td>
<td style="text-align: right;">
124.0
</td>
</tr>
<tr>
<td style="text-align: left;">
   Std. dev. 
</td>
<td style="text-align: right;">
24.7
</td>
<td style="text-align: right;">
</td>
<td style="text-align: right;">
</td>
<td style="text-align: right;">
36.8
</td>
</tr>
<tr>
<td style="border-bottom: 2px solid grey; text-align: left;">
   Unw. valid N 
</td>
<td style="border-bottom: 2px solid grey; text-align: right;">
2.0
</td>
<td style="border-bottom: 2px solid grey; text-align: right;">
1
</td>
<td style="border-bottom: 2px solid grey; text-align: right;">
1
</td>
<td style="border-bottom: 2px solid grey; text-align: right;">
2.0
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="working-with-large-datasets">Working with Large Datasets<a class="anchor" aria-label="anchor" href="#working-with-large-datasets"></a>
</h2>
<div class="section level3">
<h3 id="partial-reading">Partial Reading<a class="anchor" aria-label="anchor" href="#partial-reading"></a>
</h3>
<p>Over the years, data files have grown in size. In the early days of
Stata, the maximum number of observations was stored as
<code>uint32_t</code> and the variables as <code>uint16_t</code>. This
allowed a maximum number of 4,294,967,295 observations and 65,535
variables. Nowadays, the limit is <code>uint64_t</code> for observations
(18,446,744,073,709,551,615) and <code>uint32_t</code> for variables.
Thus, it is easier to store large data sets in a single file, but the
advantages of simply storing data come with longer import times and
limited memory as bottlenecks. Even though handling gigabyte-wide data
works on newer workstations, not all of us want to invest in such a
workstation, especially if we only need a fraction of the data set. For
such cases, <code>readstata13</code> offers selections for ranges of
observations (the first/last n observations or, e.g., rows 5-10) and
selections of specific variables.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read rows 1 to 3</span></span>
<span><span class="va">dat_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="st">"res/cars.dta"</span>, select.rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>; <span class="va">dat_1</span></span>
<span><span class="co">#&gt;   speed dist</span></span>
<span><span class="co">#&gt; 1     4    2</span></span>
<span><span class="co">#&gt; 2     4   10</span></span>
<span><span class="co">#&gt; 3     7    4</span></span>
<span></span>
<span><span class="co"># Read only variable "dist"</span></span>
<span><span class="va">dat_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="st">"res/cars.dta"</span>, select.cols <span class="op">=</span> <span class="st">"dist"</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat_2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   dist</span></span>
<span><span class="co">#&gt; 1    2</span></span>
<span><span class="co">#&gt; 2   10</span></span>
<span><span class="co">#&gt; 3    4</span></span>
<span><span class="co">#&gt; 4   22</span></span>
<span><span class="co">#&gt; 5   16</span></span>
<span><span class="co">#&gt; 6   10</span></span></code></pre></div>
<p>A real-world example where the selection of certain variables is
helpful is the SOEP dataset.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> The dataset is divided among different
files; it is best to think of it as tables in a database. As is common
in a database environment, you need to make some connections between the
files and therefore need to know some key variables of different files.
The dataset has been collected annually since 1984 and has grown
significantly, with many cases and many variables in different files.
Selecting a particular variable from a file resulted in reading the
entire file (all <em>n</em> cases and <em>k</em> variables), extracting
the variable, and removing all other variables. Importing such a large
file takes quite a while, and the import results in a large R object
that is not needed at all. With a selection of variables, it is possible
to import only the data you want and skip everything else, making the
import process fast and memory efficient.</p>
</div>
<div class="section level3">
<h3 id="compression">Compression<a class="anchor" aria-label="anchor" href="#compression"></a>
</h3>
<p>If you want to minimize the memory size of the written files, you can
instruct <code>save.dta13</code> with <code>compress = TRUE</code> to
use the smallest available type for writing a file.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save with compression</span></span>
<span><span class="fu"><a href="../reference/save.dta13.html">save.dta13</a></span><span class="op">(</span><span class="va">cars</span>, file <span class="op">=</span> <span class="st">"res/cars_compress.dta"</span>, compress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import and compare types</span></span>
<span><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"res/cars_compress.dta"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">dat2</span>, <span class="st">"types"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 65530 65529</span></span></code></pre></div>
<p>First, <code>save.dta13</code> evaluated that it is safe to store the
<code>numeric</code> vector as an <code>integer</code>. In a second
step, the smallest binary type was chosen. For the R user, the only
notable change is that after re-import, the former <code>numeric</code>
has become an <code>integer</code>. The most significant change is the
file size of the written dta file.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="st">"res/cars.dta"</span><span class="op">)</span><span class="op">[</span><span class="st">"size"</span><span class="op">]</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="st">"res/cars_compress.dta"</span><span class="op">)</span><span class="op">[</span><span class="st">"size"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;                       size</span></span>
<span><span class="co">#&gt; res/cars.dta          1762</span></span>
<span><span class="co">#&gt; res/cars_compress.dta 1112</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-features">Advanced Features<a class="anchor" aria-label="anchor" href="#advanced-features"></a>
</h2>
<div class="section level3">
<h3 id="frames">Frames<a class="anchor" aria-label="anchor" href="#frames"></a>
</h3>
<p>Starting with version 16, Stata users can store multiple data <a href="https://www.stata.com/help.cgi?frames" class="external-link">frames</a> simultaneously
in memory (short: frames) and save them to disk as a “Stata frameset.”
The corresponding Stata function will create a “.dtas” file, which is a
zip file that contains a dta file for each frame.</p>
<p>The function <code>get.frames</code> prints information about the
frames from a dtas file: <code>name</code> is the frame name defined in
Stata.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dtas_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"myproject2.dtas"</span>, package<span class="op">=</span><span class="st">"readstata13"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get.frames.html">get.frames</a></span><span class="op">(</span><span class="va">dtas_path</span><span class="op">)</span></span>
<span><span class="co">#&gt;       name      filename version</span></span>
<span><span class="co">#&gt; 1  persons  persons~0000     120</span></span>
<span><span class="co">#&gt; 2 counties counties~0001     118</span></span></code></pre></div>
<p>Use <code>read.dtas</code> to import all or selected frames from a
dtas file. By default, <code>read.dtas</code> imports all frames and
returns a <code>list</code> of <code>data.frames</code>. Each frame is
accessible in the list by the name defined in Stata.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read.dtas.html">read.dtas</a></span><span class="op">(</span><span class="va">dtas_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in stata_read(filepath, missing.type, select.rows, select.cols_chr, :</span></span>
<span><span class="co">#&gt; File contains unhandled alias variable in column: 5</span></span>
<span><span class="co">#&gt; $persons</span></span>
<span><span class="co">#&gt;    personid countyid income counties median     ratio</span></span>
<span><span class="co">#&gt; 1         1        5  30818        5        0.7038001</span></span>
<span><span class="co">#&gt; 2         2        3  30752        3        0.4225046</span></span>
<span><span class="co">#&gt; 3         3        2  29673        2        0.5230381</span></span>
<span><span class="co">#&gt; 4         4        3  32115        3        0.4412310</span></span>
<span><span class="co">#&gt; 5         5        2  31189        2        0.5497603</span></span>
<span><span class="co">#&gt; 6         6        1  30992        1        0.6725256</span></span>
<span><span class="co">#&gt; 7         7        3  34328        3        0.4716356</span></span>
<span><span class="co">#&gt; 8         8        3  31508        3        0.4328914</span></span>
<span><span class="co">#&gt; 9         9        5  26071        5        0.5953915</span></span>
<span><span class="co">#&gt; 10       10        5  29768        5        0.6798210</span></span>
<span><span class="co">#&gt; 11       11        2  34757        2        0.6126525</span></span>
<span><span class="co">#&gt; 12       12        3  25630        3        0.3521330</span></span>
<span><span class="co">#&gt; 13       13        1  29146        1        0.6324675</span></span>
<span><span class="co">#&gt; 14       14        5  25752        5        0.5881063</span></span>
<span><span class="co">#&gt; 15       15        1  26806        1        0.5816895</span></span>
<span><span class="co">#&gt; 16       16        2  34368        2        0.6057957</span></span>
<span><span class="co">#&gt; 17       17        3  26914        3        0.3697740</span></span>
<span><span class="co">#&gt; 18       18        2  25886        2        0.4562857</span></span>
<span><span class="co">#&gt; 19       19        1  29321        1        0.6362650</span></span>
<span><span class="co">#&gt; 20       20        5  29571        5        0.6753220</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counties</span></span>
<span><span class="co">#&gt;    countyid median_income</span></span>
<span><span class="co">#&gt; 1    Brazos         46083</span></span>
<span><span class="co">#&gt; 2    Dallas         56732</span></span>
<span><span class="co">#&gt; 3    Travis         72785</span></span>
<span><span class="co">#&gt; 4    Harris         58664</span></span>
<span><span class="co">#&gt; 5    Potter         43788</span></span>
<span><span class="co">#&gt; 6   El Paso         44120</span></span>
<span><span class="co">#&gt; 7     Bowie         49153</span></span>
<span><span class="co">#&gt; 8 Galveston         69674</span></span></code></pre></div>
<p>To restrict the import to one or several frames you may use the
<code>select.frames</code> argument.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read selected frames</span></span>
<span><span class="fu"><a href="../reference/read.dtas.html">read.dtas</a></span><span class="op">(</span><span class="va">dtas_path</span>, select.frames <span class="op">=</span> <span class="st">"counties"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $counties</span></span>
<span><span class="co">#&gt;    countyid median_income</span></span>
<span><span class="co">#&gt; 1    Brazos         46083</span></span>
<span><span class="co">#&gt; 2    Dallas         56732</span></span>
<span><span class="co">#&gt; 3    Travis         72785</span></span>
<span><span class="co">#&gt; 4    Harris         58664</span></span>
<span><span class="co">#&gt; 5    Potter         43788</span></span>
<span><span class="co">#&gt; 6   El Paso         44120</span></span>
<span><span class="co">#&gt; 7     Bowie         49153</span></span>
<span><span class="co">#&gt; 8 Galveston         69674</span></span></code></pre></div>
<p>You may also define additional options for each frame individually.
The options must be provided as a list with the structure
<code>list(framename = list(param = value))</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read frames with different arguments</span></span>
<span><span class="fu"><a href="../reference/read.dtas.html">read.dtas</a></span><span class="op">(</span><span class="va">dtas_path</span>, </span>
<span>          read.dta13.options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>counties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>select.cols <span class="op">=</span> <span class="st">"median_income"</span><span class="op">)</span>,</span>
<span>                                     persons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>select.cols <span class="op">=</span> <span class="st">"income"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $persons</span></span>
<span><span class="co">#&gt;    income</span></span>
<span><span class="co">#&gt; 1   30818</span></span>
<span><span class="co">#&gt; 2   30752</span></span>
<span><span class="co">#&gt; 3   29673</span></span>
<span><span class="co">#&gt; 4   32115</span></span>
<span><span class="co">#&gt; 5   31189</span></span>
<span><span class="co">#&gt; 6   30992</span></span>
<span><span class="co">#&gt; 7   34328</span></span>
<span><span class="co">#&gt; 8   31508</span></span>
<span><span class="co">#&gt; 9   26071</span></span>
<span><span class="co">#&gt; 10  29768</span></span>
<span><span class="co">#&gt; 11  34757</span></span>
<span><span class="co">#&gt; 12  25630</span></span>
<span><span class="co">#&gt; 13  29146</span></span>
<span><span class="co">#&gt; 14  25752</span></span>
<span><span class="co">#&gt; 15  26806</span></span>
<span><span class="co">#&gt; 16  34368</span></span>
<span><span class="co">#&gt; 17  26914</span></span>
<span><span class="co">#&gt; 18  25886</span></span>
<span><span class="co">#&gt; 19  29321</span></span>
<span><span class="co">#&gt; 20  29571</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counties</span></span>
<span><span class="co">#&gt;   median_income</span></span>
<span><span class="co">#&gt; 1         46083</span></span>
<span><span class="co">#&gt; 2         56732</span></span>
<span><span class="co">#&gt; 3         72785</span></span>
<span><span class="co">#&gt; 4         58664</span></span>
<span><span class="co">#&gt; 5         43788</span></span>
<span><span class="co">#&gt; 6         44120</span></span>
<span><span class="co">#&gt; 7         49153</span></span>
<span><span class="co">#&gt; 8         69674</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="long-strings-strl">Long Strings (strL)<a class="anchor" aria-label="anchor" href="#long-strings-strl"></a>
</h3>
<p>With Stata 13, long strings were introduced. Such strings are stored
in the dta file below the data part. This keeps the data part compact,
containing only a reference to the string. Since long strings are
capable of storing entire novels, we leave the decision of how to handle
such files to the user. By default, they are replaced; if not desired,
they are stored as an attribute to the R object.</p>
<p>In a blog post, Stata explained how it is possible to store binary
data in strLs.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> This allows image, video, audio, or text
files to be stored alongside the data. Although interesting, it is
currently not possible to handle such data in a <code>data.frame</code>
in R.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>
Since <code>readstata13</code> release <code>0.9.1</code>, it possible
to export such files to a user-defined folder, by default the current
working directory.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># export the strl as binary file to the current working directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"res/strls/"</span><span class="op">)</span></span>
<span><span class="va">dat_strl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="st">"stata_strl.dta"</span>, strlexport <span class="op">=</span> <span class="cn">TRUE</span>, strlpath <span class="op">=</span> <span class="st">"res/strls/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The folder contains a file for each long string. The first file is a .txt file and the second a .png file.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="st">"res/strls/"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "15_1" "16_1"</span></span></code></pre></div>
<p>The exported files are without a file extension because a specific
file type is not known (and may be different for each cell). Therefore,
the binary file is named only by its position in the data (15_1 is the
15th variable and 1st observation), leaving the user to choose how to
process its content. In this example, the first file is a txt file.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">"res/strls/15_1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "R is a free software environment for statistical computing and graphics. It compiles and runs on a wide variety of UNIX platforms, Windows and MacOS. To download R, please choose your preferred CRAN mirror."</span></span>
<span><span class="co">#&gt; [2] ""                                                                                                                                                                                                              </span></span>
<span><span class="co">#&gt; [3] "If you have questions about R like how to download and install the software, or what the license terms are, please read our answers to frequently asked questions before you send an email."                   </span></span>
<span><span class="co">#&gt; [4] ""</span></span></code></pre></div>
<p>The second file is image in PNG format.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.rforge.net/png/" class="external-link">png</a></span><span class="op">)</span></span>
<span><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/png/man/readPNG.html" class="external-link">readPNG</a></span><span class="op">(</span><span class="st">"res/strls/16_1"</span><span class="op">)</span></span>
<span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.raster.html" class="external-link">grid.raster</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></span></code></pre></div>
<p><img src="readstata13_basic_manual_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>The dta format for current versions is well documented
at <a href="https://www.stata.com/help.cgi?dta" class="external-link uri">https://www.stata.com/help.cgi?dta</a> and also in the
corresponding manuals.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>A detailed explanation can be found here: <a href="https://en.wikipedia.org/wiki/Endianness" class="external-link uri">https://en.wikipedia.org/wiki/Endianness</a>.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>In a branch on GitHub, we even support reading the
never-released <code>116</code> format, for which a single publicly
available Stata sample file exists.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>The SOEP is currently located at the <a href="https://www.diw.de/" class="external-link">DIW Berlin</a>.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>The blog post describes how physicians could use the
feature to store images of X-rays alongside patient data. <a href="https://www.stata.com/stata-news/news31-4/spotlight/" class="external-link">“In the
spotlight: Storing long strings and entire files in Stata
datasets”</a>.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Part of the issue is that there is no R vector object
capable of image processing, and R’s <code>character</code> vector is
not exactly a good place to store binary data. This is also why we are
(currently) not able to create such a file from R.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jan Marvin Garbuszus, Sebastian Jeworutzki.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
