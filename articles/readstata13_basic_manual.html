<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>readstata13: Basic Manual • readstata13</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="readstata13: Basic Manual">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">readstata13</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/readstata13_basic_manual.html">readstata13: Basic Manual</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sjewo/readstata13/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>readstata13: Basic Manual</h1>
                        <h4 data-toc-skip class="author">Jan Marvin
Garbuszus &amp; Sebastian Jeworutzki</h4>
            
            <h4 data-toc-skip class="date">2025-04-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sjewo/readstata13/blob/main/vignettes/readstata13_basic_manual.Rmd" class="external-link"><code>vignettes/readstata13_basic_manual.Rmd</code></a></small>
      <div class="d-none name"><code>readstata13_basic_manual.Rmd</code></div>
    </div>

    
    
<p>The <code>readstata13</code> package was developed to address
compatibility issues arising from changes in the Stata 13 dta file
format. Prior to Stata 13, packages like <code>foreign</code> could
handle dta files. However, Stata 13 introduced a new format that
resembles XML.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;The dta format for current versions is well documented
at &lt;a href="https://www.stata.com/help.cgi?dta" class="external-link uri"&gt;https://www.stata.com/help.cgi?dta&lt;/a&gt; and also in the
corresponding manuals.&lt;/p&gt;'><sup>1</sup></a> Recognizing the need for a new solution, we
(Jan Marvin Garbuszus and Sebastian Jeworutzki) created
<code>readstata13</code>. Leveraging Rcpp for performance, the package
has evolved into a comprehensive tool for working with dta files in
R.</p>
<p>Key features of <code>readstata13</code> include:</p>
<ul>
<li>
<strong>Broad Format Support:</strong> Ability to import and export
dta files across a wide range of Stata versions, including many
undocumented formats.</li>
<li>
<strong>Handling Advanced Features:</strong> Support for features
like string encoding, multilingual labels, business calendars, long
strings (<code>strL</code>), frames, and embedded binary data.</li>
<li>
<strong>Enhanced Functionality:</strong> Built as a direct
replacement for <code>foreign</code>’s dta functions, with added
capabilities for improved label handling (including generation) and
partial data reading (selecting specific rows or variables).</li>
</ul>
<div class="section level2">
<h2 id="core-functionality-reading-and-writing-stata-files">Core Functionality: Reading and Writing Stata files<a class="anchor" aria-label="anchor" href="#core-functionality-reading-and-writing-stata-files"></a>
</h2>
<p>Importing a Stata file using <code>readstata13</code> is
straightforward, similar to using the <code>foreign</code> package. The
primary function is <code>read.dta13</code>. To save an R data frame to
the Stata dta format, you use the <code>save.dta13</code> function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span> <span class="op">(</span><span class="va">cars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the 'cars' dataset to a Stata file</span></span>
<span><span class="fu"><a href="../reference/save.dta13.html">save.dta13</a></span><span class="op">(</span><span class="va">cars</span>, file <span class="op">=</span> <span class="st">"res/cars.dta"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read the saved Stata file back into R</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="st">"res/cars.dta"</span><span class="op">)</span></span></code></pre></div>
<p>Beyond the data itself, <code>readstata13</code> preserves important
metadata from the Stata file. This information is stored as attributes
of the imported data frame.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prints the attributes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; $row.names</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25</span></span>
<span><span class="co">#&gt; [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $names</span></span>
<span><span class="co">#&gt; [1] "speed" "dist" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $class</span></span>
<span><span class="co">#&gt; [1] "data.frame"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $datalabel</span></span>
<span><span class="co">#&gt; [1] "Written by R"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $time.stamp</span></span>
<span><span class="co">#&gt; [1] "25 Apr 2025 09:20"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $formats</span></span>
<span><span class="co">#&gt; [1] "%9.0g" "%9.0g"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $types</span></span>
<span><span class="co">#&gt; [1] 65526 65526</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $val.labels</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; "" "" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $var.labels</span></span>
<span><span class="co">#&gt; [1] "" ""</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $version</span></span>
<span><span class="co">#&gt; [1] 117</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $label.table</span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $expansion.fields</span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $byteorder</span></span>
<span><span class="co">#&gt; [1] "LSF"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $orig.dim</span></span>
<span><span class="co">#&gt; [1] 50  2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data.label</span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre></div>
<p>Examining the attributes reveals details such as the Stata format
version (e.g., format 117, introduced in Stata 13), a data label, a
timestamp, and information about the data types and formats used in
Stata. In this example, the <code>save.dta13</code> function wrote the
numeric data from R as binary <code>double</code>s in the dta file. The
byte order (endianness) is also recorded; <code>readstata13</code> is
designed to handle both Little Endian (used here) and Big Endian formats
during reading and writing.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;A detailed explanation can be found here: &lt;a href="https://en.wikipedia.org/wiki/Endianness" class="external-link uri"&gt;https://en.wikipedia.org/wiki/Endianness&lt;/a&gt;.&lt;/p&gt;'><sup>2</sup></a></p>
<p>The package automatically manages the conversion of Stata’s missing
values, value labels, and variable labels during both import and
export.</p>
</div>
<div class="section level2">
<h2 id="supported-stata-versions">Supported Stata Versions<a class="anchor" aria-label="anchor" href="#supported-stata-versions"></a>
</h2>
<p>A key advantage of <code>readstata13</code> is its ability to write
dta files compatible with older and newer versions of Stata. This is
controlled using the <code>version</code> argument in the
<code>save.dta13</code> function. The table below lists supported Stata
versions and their corresponding file formats:</p>
<table class="table">
<thead><tr class="header">
<th>Stata Version</th>
<th>File Format</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>18 - 19</td>
<td>121</td>
</tr>
<tr class="even">
<td>18 - 19</td>
<td>120</td>
</tr>
<tr class="odd">
<td>15 - 19</td>
<td>119</td>
</tr>
<tr class="even">
<td>14 - 19</td>
<td>118</td>
</tr>
<tr class="odd">
<td>13</td>
<td>117</td>
</tr>
<tr class="even">
<td>12</td>
<td>115</td>
</tr>
<tr class="odd">
<td>10 - 11</td>
<td>114</td>
</tr>
<tr class="even">
<td>8 - 9</td>
<td>113</td>
</tr>
<tr class="odd">
<td>7</td>
<td>110</td>
</tr>
<tr class="even">
<td>6</td>
<td>108</td>
</tr>
</tbody>
</table>
<p>While this table shows the most common formats,
<code>readstata13</code> supports reading files from Stata version 1
(format 102) up to the latest format 121 (used for files with over
32,767 variables, readable by Stata 18 &amp; 19 MP).<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;A &lt;a href="https://github.com/sjewo/readstata13/tree/116" class="external-link"&gt;development
branch&lt;/a&gt; on GitHub even include support for the rarely seen
&lt;code&gt;116&lt;/code&gt; format, for which only one public sample file is known
to exist.&lt;/p&gt;'><sup>3</sup></a> The dta format has
evolved over time to accommodate larger datasets and longer variable
names or labels. Although <code>readstata13</code> can read virtually
any format, its ability to write files that <em>fit</em> within Stata’s
historical limits depends on the data size. For general compatibility,
it’s recommended to target versions 7 or later (formats 110+), which
aligns with the default in <code><a href="https://rdrr.io/pkg/foreign/man/write.dta.html" class="external-link">foreign::write.dta</a></code>.</p>
<p>Here’s an example of saving a file compatible with Stata 7:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save the cars dataset as a Stata 7 dta file</span></span>
<span><span class="fu"><a href="../reference/save.dta13.html">save.dta13</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"res/cars_version.dta"</span>, version <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read the file back and check its reported version</span></span>
<span><span class="va">dat3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="st">"res/cars_version.dta"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">dat3</span>, <span class="st">"version"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 110</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="working-with-labelled-data">Working with Labelled Data<a class="anchor" aria-label="anchor" href="#working-with-labelled-data"></a>
</h2>
<p>Stata datasets often include rich metadata like variable and value
labels. Since base R data frames don’t natively support this,
<code>readstata13</code> stores this information in various attributes
of the imported data frame, mirroring the approach used by
<code><a href="https://rdrr.io/pkg/foreign/man/read.dta.html" class="external-link">foreign::read.dta</a></code>.</p>
<p>Let’s use the example dataset “statacar.dta” included with the
<code>readstata13</code> package. We’ll initially import it without
converting categorical data to R factors, keeping the original numeric
codes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sjewo/readstata13" class="external-link">readstata13</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/statacar.dta"</span>, </span>
<span>                            package <span class="op">=</span> <span class="st">"readstata13"</span><span class="op">)</span>,</span>
<span>                convert.factors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Variable labels are accessible via the <code>var.labels</code>
attribute:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"var.labels"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Numeric ID"             "Brand of car"           "Car model"             </span></span>
<span><span class="co">#&gt;  [4] "Car classification"     "Horse Power"            "Maximum speed"         </span></span>
<span><span class="co">#&gt;  [7] ""                       ""                       "Launch date"           </span></span>
<span><span class="co">#&gt; [10] "Launch date (calendar)" ""</span></span></code></pre></div>
<p>You can retrieve the label for a specific variable using the
<code><a href="../reference/varlabel.html">varlabel()</a></code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/varlabel.html">varlabel</a></span><span class="op">(</span><span class="va">x</span>, var.name <span class="op">=</span> <span class="st">"type"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 type </span></span>
<span><span class="co">#&gt; "Car classification"</span></span></code></pre></div>
<p>Value labels, which map numeric codes to descriptive text, are stored
in a more structured way. The <code>val.labels</code> attribute
indicates which variables have associated value labels. The actual label
definitions (the mapping from codes to labels) are stored as a list in
the <code>label.table</code> attribute.</p>
<p>In our example dataset, only one column has value labels:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"val.labels"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                 type_en                                         </span></span>
<span><span class="co">#&gt;        ""        ""        "" "type_en"        ""        ""        ""        "" </span></span>
<span><span class="co">#&gt;                               </span></span>
<span><span class="co">#&gt;        ""        ""        ""</span></span></code></pre></div>
<p>The corresponding label table for the ‘type’ variable is named
<code>type_en</code>. It’s a named vector where the numeric codes are
the vector values and the labels are the names:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"label.table"</span><span class="op">)</span><span class="op">$</span><span class="va">type_en</span></span>
<span><span class="co">#&gt;         min    Off-Road    Roadster    City car  Family car         max </span></span>
<span><span class="co">#&gt; -2147483647           1           2           3           4  2147483620</span></span></code></pre></div>
<p>Convenience functions like <code><a href="../reference/get.label.name.html">get.label.name()</a></code> and
<code><a href="../reference/get.label.html">get.label()</a></code> provide alternative ways to access this
information:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get.label.name.html">get.label.name</a></span><span class="op">(</span><span class="va">x</span>, var.name <span class="op">=</span> <span class="st">"type"</span><span class="op">)</span></span>
<span><span class="co">#&gt;      type </span></span>
<span><span class="co">#&gt; "type_en"</span></span>
<span><span class="fu"><a href="../reference/get.label.html">get.label</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"type_en"</span><span class="op">)</span></span>
<span><span class="co">#&gt;         min    Off-Road    Roadster    City car  Family car         max </span></span>
<span><span class="co">#&gt; -2147483647           1           2           3           4  2147483620</span></span></code></pre></div>
<p>A common task is converting a numeric variable with value labels into
an R factor. <code>readstata13</code> simplifies this with the
<code><a href="../reference/set.label.html">set.label()</a></code> function, which uses the stored label
information to create the factor levels.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a factor variable 'type_en' from the 'type' variable using stored labels</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">type_en</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set.label.html">set.label</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"type"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the original numeric column and the new factor column</span></span>
<span><span class="va">x</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"type"</span>, <span class="st">"type_en"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;          type    type_en</span></span>
<span><span class="co">#&gt; 1           2   Roadster</span></span>
<span><span class="co">#&gt; 2           4 Family car</span></span>
<span><span class="co">#&gt; 3           3   City car</span></span>
<span><span class="co">#&gt; 4           4 Family car</span></span>
<span><span class="co">#&gt; 5           1   Off-Road</span></span>
<span><span class="co">#&gt; 6           3   City car</span></span>
<span><span class="co">#&gt; 7  2147483620        max</span></span>
<span><span class="co">#&gt; 8 -2147483647        min</span></span></code></pre></div>
<div class="section level3">
<h3 id="multi-language-support-for-labels">Multi-Language Support for Labels<a class="anchor" aria-label="anchor" href="#multi-language-support-for-labels"></a>
</h3>
<p>Stata allows datasets to include labels in multiple languages.
<code>readstata13</code> supports this, and the <code>lang</code> option
in <code><a href="../reference/set.label.html">set.label()</a></code> lets you specify which language’s labels to
use when creating a factor.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check available languages and the default language</span></span>
<span><span class="fu"><a href="../reference/get.lang.html">get.lang</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; Available languages:</span></span>
<span><span class="co">#&gt;  en</span></span>
<span><span class="co">#&gt;  de</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Default language:</span></span>
<span><span class="co">#&gt;  en</span></span>
<span></span>
<span><span class="co"># Create a factor using the German labels</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">type_de</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set.label.html">set.label</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"type"</span>, lang <span class="op">=</span> <span class="st">"de"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the original and both language factor columns</span></span>
<span><span class="va">x</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"type"</span>, <span class="st">"type_en"</span>, <span class="st">"type_de"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;          type    type_en      type_de</span></span>
<span><span class="co">#&gt; 1           2   Roadster   Sportwagen</span></span>
<span><span class="co">#&gt; 2           4 Family car Familienauto</span></span>
<span><span class="co">#&gt; 3           3   City car    Stadtauto</span></span>
<span><span class="co">#&gt; 4           4 Family car Familienauto</span></span>
<span><span class="co">#&gt; 5           1   Off-Road Geländewagen</span></span>
<span><span class="co">#&gt; 6           3   City car    Stadtauto</span></span>
<span><span class="co">#&gt; 7  2147483620        max          max</span></span>
<span><span class="co">#&gt; 8 -2147483647        min          min</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compatibility-with-other-packages">Compatibility with Other Packages<a class="anchor" aria-label="anchor" href="#compatibility-with-other-packages"></a>
</h3>
<p><code>readstata13</code> is designed to integrate well with other R
packages that work with labelled data, such as <code>labelled</code> and
<code>expss</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Requires labelled package version &gt; 2.8.0 due to a past bug</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://larmarange.github.io/labelled/" class="external-link">labelled</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read the data and convert to the 'labelled' class format</span></span>
<span><span class="va">xl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/statacar.dta"</span>, </span>
<span>                             package <span class="op">=</span> <span class="st">"readstata13"</span><span class="op">)</span>,</span>
<span>                convert.factors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://larmarange.github.io/labelled/reference/to_labelled.html" class="external-link">to_labelled</a></span><span class="op">(</span><span class="va">xl</span><span class="op">)</span></span>
<span><span class="va">xl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 11</span></span></span>
<span><span class="co">#&gt;      id brand   model    type     hp         max  mileage  ecar ldate ldatecal  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Meyer   Spee…  2   <span style="color: #949494;">e</span>0    150    1.77<span style="color: #949494;">e</span>  2  1.02<span style="color: #949494;">e</span> 1     0     1 2001-01-03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 Meyer   Happ…  4   <span style="color: #949494;">e</span>0     98    1.45<span style="color: #949494;">e</span>  2  5.60<span style="color: #949494;">e</span> 0     0   247 2001-12-31</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 Akiko   Susu…  3   <span style="color: #949494;">e</span>0     45    1.19<span style="color: #949494;">e</span>  2 <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>       0    14 2001-01-23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 Akiko   Susu…  4   <span style="color: #949494;">e</span>0     80    1.27<span style="color: #949494;">e</span>  2  6.80<span style="color: #949494;">e</span> 0     0   134 2001-07-16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 Hutch   Lumb…  1   <span style="color: #949494;">e</span>0    180    1.56<span style="color: #949494;">e</span>  2  1.42<span style="color: #949494;">e</span> 1     0   110 2001-06-11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6 Erikson E-Ca…  3   <span style="color: #949494;">e</span>0     <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>       1   100 2001-05-25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>     7 Erikson Maxi…  2.15<span style="color: #949494;">e</span>9  <span style="text-decoration: underline;">32</span>740    8.99<span style="color: #949494;">e</span>307  1.70<span style="color: #949494;">e</span>38   100    19 2001-01-30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>     7 Erikson Mimi… -<span style="color: #BB0000;">2.15</span><span style="color: #949494;">e</span>9 -<span style="color: #BB0000; text-decoration: underline;">32</span><span style="color: #BB0000;">767</span> -<span style="color: #BB0000;">Inf</span>   <span style="color: #949494;"> </span>    -<span style="color: #BB0000;">1.70</span><span style="color: #949494;">e</span>38  -<span style="color: #BB0000;">127</span>     1 2001-01-03</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: modelStrL &lt;chr&gt;</span></span></span></code></pre></div>
<p>Packages like <code>expss</code> can utilize the label information
stored by <code>readstata13</code> (and converted by
<code>labelled</code>) for creating descriptive tables and plots.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gdemin.github.io/expss/" class="external-link">expss</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: maditr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use magrittr pipe '%&gt;%' to chain several operations:</span></span>
<span><span class="co">#&gt;              mtcars %&gt;%</span></span>
<span><span class="co">#&gt;                  let(mpg_hp = mpg/hp) %&gt;%</span></span>
<span><span class="co">#&gt;                  take(mean(mpg_hp), by = am)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use 'expss_output_viewer()' to display tables in the RStudio Viewer.</span></span>
<span><span class="co">#&gt;  To return to the console output, use 'expss_output_default()'.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'expss'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:labelled':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     is.labelled</span></span>
<span></span>
<span><span class="co"># Example: Use expss to create a table summarizing horse power by car brand</span></span>
<span><span class="co"># First, handle missing or negative HP values</span></span>
<span><span class="va">xl</span><span class="op">[</span><span class="va">xl</span><span class="op">$</span><span class="va">hp</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">xl</span><span class="op">$</span><span class="va">hp</span><span class="op">)</span>, <span class="st">"hp"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># Create the table using expss piping syntax</span></span>
<span><span class="va">xl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/expss/man/tables.html" class="external-link">tab_cells</a></span><span class="op">(</span><span class="va">hp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Specify the variable for cells</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/expss/man/tables.html" class="external-link">tab_cols</a></span><span class="op">(</span><span class="va">brand</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Specify the variable for columns</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/expss/man/tables.html" class="external-link">tab_stat_mean_sd_n</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Calculate mean, standard deviation, and N</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/expss/man/tables.html" class="external-link">tab_pivot</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Pivot the table</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/expss/man/set_caption.html" class="external-link">set_caption</a></span><span class="op">(</span><span class="st">"Horse power by car brand."</span><span class="op">)</span> <span class="co"># Add a caption</span></span></code></pre></div>
<table class="table gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<td colspan="5" style="text-align: left;">
Horse power by car brand.
</td>
</tr>
<tr>
<th style="border-top: 2px solid grey;">
</th>
<th colspan="4" style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
 Brand of car 
</th>
</tr>
<tr>
<th style="border-bottom: 1px solid grey; font-weight: 900; text-align: center;">
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; text-align: center;">
 Akiko 
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; text-align: center;">
 Erikson 
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; text-align: center;">
 Hutch 
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; text-align: center;">
 Meyer 
</th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="5" style="font-weight: 900;">
 Horse Power 
</td>
</tr>
<tr>
<td style="text-align: left;">
   Mean 
</td>
<td style="text-align: right;">
62.5
</td>
<td style="text-align: right;">
32740
</td>
<td style="text-align: right;">
180
</td>
<td style="text-align: right;">
124.0
</td>
</tr>
<tr>
<td style="text-align: left;">
   Std. dev. 
</td>
<td style="text-align: right;">
24.7
</td>
<td style="text-align: right;">
</td>
<td style="text-align: right;">
</td>
<td style="text-align: right;">
36.8
</td>
</tr>
<tr>
<td style="border-bottom: 2px solid grey; text-align: left;">
   Unw. valid N 
</td>
<td style="border-bottom: 2px solid grey; text-align: right;">
2.0
</td>
<td style="border-bottom: 2px solid grey; text-align: right;">
1
</td>
<td style="border-bottom: 2px solid grey; text-align: right;">
1
</td>
<td style="border-bottom: 2px solid grey; text-align: right;">
2.0
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="handling-large-datasets">Handling Large Datasets<a class="anchor" aria-label="anchor" href="#handling-large-datasets"></a>
</h2>
<p>As datasets grow, importing and managing them in memory can become
challenging. <code>readstata13</code> provides features to work
efficiently with large dta files.</p>
<div class="section level3">
<h3 id="partial-reading">Partial Reading<a class="anchor" aria-label="anchor" href="#partial-reading"></a>
</h3>
<p>To avoid loading an entire large dataset when only a subset is
needed, <code>readstata13</code> allows you to read specific rows or
columns. This is particularly useful for exploring large files or
extracting key variables without consuming excessive memory or time.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read only the first 3 rows of the dataset</span></span>
<span><span class="va">dat_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="st">"res/cars.dta"</span>, select.rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>; <span class="va">dat_1</span></span>
<span><span class="co">#&gt;   speed dist</span></span>
<span><span class="co">#&gt; 1     4    2</span></span>
<span><span class="co">#&gt; 2     4   10</span></span>
<span><span class="co">#&gt; 3     7    4</span></span>
<span></span>
<span><span class="co"># Read only the 'dist' variable from the dataset</span></span>
<span><span class="va">dat_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="st">"res/cars.dta"</span>, select.cols <span class="op">=</span> <span class="st">"dist"</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat_2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   dist</span></span>
<span><span class="co">#&gt; 1    2</span></span>
<span><span class="co">#&gt; 2   10</span></span>
<span><span class="co">#&gt; 3    4</span></span>
<span><span class="co">#&gt; 4   22</span></span>
<span><span class="co">#&gt; 5   16</span></span>
<span><span class="co">#&gt; 6   10</span></span></code></pre></div>
<p>A practical application of partial reading is working with large
survey datasets like the SOEP (German Socio-Economic Panel).<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;The SOEP is currently located at the &lt;a href="https://www.diw.de/" class="external-link"&gt;DIW Berlin&lt;/a&gt;.&lt;/p&gt;'><sup>4</sup></a> These
datasets are often distributed across multiple files, structured like
tables in a database. To link information across files, you need key
identifier variables. Instead of importing entire multi-gigabyte files
just to get a few ID columns, you can use <code>select.cols</code> to
quickly and efficiently read only the necessary variables.</p>
</div>
<div class="section level3">
<h3 id="compression">Compression<a class="anchor" aria-label="anchor" href="#compression"></a>
</h3>
<p>When saving data to a dta file, you can use the
<code>compress = TRUE</code> option in <code>save.dta13</code>. This
instructs the package to use the smallest possible Stata data type for
each variable, potentially reducing the file size.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save the cars dataset with compression enabled</span></span>
<span><span class="fu"><a href="../reference/save.dta13.html">save.dta13</a></span><span class="op">(</span><span class="va">cars</span>, file <span class="op">=</span> <span class="st">"res/cars_compress.dta"</span>, compress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import the compressed file and check the resulting data types</span></span>
<span><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"res/cars_compress.dta"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">dat2</span>, <span class="st">"types"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 65530 65529</span></span></code></pre></div>
<p>In this example, the <code>numeric</code> vector in R was safely
stored as an <code>integer</code> in the compressed dta file because its
values fit within the integer range. The main benefit of compression is
the reduction in file size. The only notable change is that after
re-import, the former <code>numeric</code> column has become an
<code>integer</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="st">"res/cars.dta"</span><span class="op">)</span><span class="op">[</span><span class="st">"size"</span><span class="op">]</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="st">"res/cars_compress.dta"</span><span class="op">)</span><span class="op">[</span><span class="st">"size"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;                       size</span></span>
<span><span class="co">#&gt; res/cars.dta          1762</span></span>
<span><span class="co">#&gt; res/cars_compress.dta 1112</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-features">Advanced Features<a class="anchor" aria-label="anchor" href="#advanced-features"></a>
</h2>
<div class="section level3">
<h3 id="frames">Frames<a class="anchor" aria-label="anchor" href="#frames"></a>
</h3>
<p>Stata version 16 introduced the concept of data <a href="https://www.stata.com/help.cgi?frames" class="external-link">frames</a>, allowing
multiple datasets to be held in memory simultaneously and saved together
in a “.dtas” file (a Stata frameset). A “.dtas” file is essentially a
zip archive containing a separate dta file for each frame.</p>
<p>The <code>get.frames</code> function in <code>readstata13</code> can
inspect a “.dtas” file and list the names (defined within Stata), the
internal filename and version of the frames it contains:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dtas_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"myproject2.dtas"</span>,</span>
<span>                         package<span class="op">=</span><span class="st">"readstata13"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get information about frames in the .dtas file</span></span>
<span><span class="fu"><a href="../reference/get.frames.html">get.frames</a></span><span class="op">(</span><span class="va">dtas_path</span><span class="op">)</span></span>
<span><span class="co">#&gt;       name      filename version</span></span>
<span><span class="co">#&gt; 1  persons  persons~0000     120</span></span>
<span><span class="co">#&gt; 2 counties counties~0001     118</span></span></code></pre></div>
<p>To import data from a “.dtas” file, use <code>read.dtas</code>. By
default, it imports all frames and returns them as a named list of R
data frames.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read all frames from the .dtas file</span></span>
<span><span class="fu"><a href="../reference/read.dtas.html">read.dtas</a></span><span class="op">(</span><span class="va">dtas_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in stata_read(filepath, missing.type, select.rows, select.cols_chr, :</span></span>
<span><span class="co">#&gt; File contains unhandled alias variable in column: 5</span></span>
<span><span class="co">#&gt; $persons</span></span>
<span><span class="co">#&gt;    personid countyid income counties median     ratio</span></span>
<span><span class="co">#&gt; 1         1        5  30818        5        0.7038001</span></span>
<span><span class="co">#&gt; 2         2        3  30752        3        0.4225046</span></span>
<span><span class="co">#&gt; 3         3        2  29673        2        0.5230381</span></span>
<span><span class="co">#&gt; 4         4        3  32115        3        0.4412310</span></span>
<span><span class="co">#&gt; 5         5        2  31189        2        0.5497603</span></span>
<span><span class="co">#&gt; 6         6        1  30992        1        0.6725256</span></span>
<span><span class="co">#&gt; 7         7        3  34328        3        0.4716356</span></span>
<span><span class="co">#&gt; 8         8        3  31508        3        0.4328914</span></span>
<span><span class="co">#&gt; 9         9        5  26071        5        0.5953915</span></span>
<span><span class="co">#&gt; 10       10        5  29768        5        0.6798210</span></span>
<span><span class="co">#&gt; 11       11        2  34757        2        0.6126525</span></span>
<span><span class="co">#&gt; 12       12        3  25630        3        0.3521330</span></span>
<span><span class="co">#&gt; 13       13        1  29146        1        0.6324675</span></span>
<span><span class="co">#&gt; 14       14        5  25752        5        0.5881063</span></span>
<span><span class="co">#&gt; 15       15        1  26806        1        0.5816895</span></span>
<span><span class="co">#&gt; 16       16        2  34368        2        0.6057957</span></span>
<span><span class="co">#&gt; 17       17        3  26914        3        0.3697740</span></span>
<span><span class="co">#&gt; 18       18        2  25886        2        0.4562857</span></span>
<span><span class="co">#&gt; 19       19        1  29321        1        0.6362650</span></span>
<span><span class="co">#&gt; 20       20        5  29571        5        0.6753220</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counties</span></span>
<span><span class="co">#&gt;    countyid median_income</span></span>
<span><span class="co">#&gt; 1    Brazos         46083</span></span>
<span><span class="co">#&gt; 2    Dallas         56732</span></span>
<span><span class="co">#&gt; 3    Travis         72785</span></span>
<span><span class="co">#&gt; 4    Harris         58664</span></span>
<span><span class="co">#&gt; 5    Potter         43788</span></span>
<span><span class="co">#&gt; 6   El Paso         44120</span></span>
<span><span class="co">#&gt; 7     Bowie         49153</span></span>
<span><span class="co">#&gt; 8 Galveston         69674</span></span></code></pre></div>
<p>You can import only specific frames using the
<code>select.frames</code> argument:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read only the "counties" frame</span></span>
<span><span class="fu"><a href="../reference/read.dtas.html">read.dtas</a></span><span class="op">(</span><span class="va">dtas_path</span>, select.frames <span class="op">=</span> <span class="st">"counties"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $counties</span></span>
<span><span class="co">#&gt;    countyid median_income</span></span>
<span><span class="co">#&gt; 1    Brazos         46083</span></span>
<span><span class="co">#&gt; 2    Dallas         56732</span></span>
<span><span class="co">#&gt; 3    Travis         72785</span></span>
<span><span class="co">#&gt; 4    Harris         58664</span></span>
<span><span class="co">#&gt; 5    Potter         43788</span></span>
<span><span class="co">#&gt; 6   El Paso         44120</span></span>
<span><span class="co">#&gt; 7     Bowie         49153</span></span>
<span><span class="co">#&gt; 8 Galveston         69674</span></span></code></pre></div>
<p>Furthermore, you can apply specific <code>read.dta13</code> options
to individual frames within the “.dtas” file by providing a list to the
<code>read.dta13.options</code> argument. The list structure should be
<code>list(framename = list(param = value))</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read frames with different column selections for each</span></span>
<span><span class="fu"><a href="../reference/read.dtas.html">read.dtas</a></span><span class="op">(</span><span class="va">dtas_path</span>,</span>
<span>          read.dta13.options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>counties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>select.cols <span class="op">=</span> <span class="st">"median_income"</span><span class="op">)</span>,</span>
<span>                                    persons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>select.cols <span class="op">=</span> <span class="st">"income"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $persons</span></span>
<span><span class="co">#&gt;    income</span></span>
<span><span class="co">#&gt; 1   30818</span></span>
<span><span class="co">#&gt; 2   30752</span></span>
<span><span class="co">#&gt; 3   29673</span></span>
<span><span class="co">#&gt; 4   32115</span></span>
<span><span class="co">#&gt; 5   31189</span></span>
<span><span class="co">#&gt; 6   30992</span></span>
<span><span class="co">#&gt; 7   34328</span></span>
<span><span class="co">#&gt; 8   31508</span></span>
<span><span class="co">#&gt; 9   26071</span></span>
<span><span class="co">#&gt; 10  29768</span></span>
<span><span class="co">#&gt; 11  34757</span></span>
<span><span class="co">#&gt; 12  25630</span></span>
<span><span class="co">#&gt; 13  29146</span></span>
<span><span class="co">#&gt; 14  25752</span></span>
<span><span class="co">#&gt; 15  26806</span></span>
<span><span class="co">#&gt; 16  34368</span></span>
<span><span class="co">#&gt; 17  26914</span></span>
<span><span class="co">#&gt; 18  25886</span></span>
<span><span class="co">#&gt; 19  29321</span></span>
<span><span class="co">#&gt; 20  29571</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counties</span></span>
<span><span class="co">#&gt;   median_income</span></span>
<span><span class="co">#&gt; 1         46083</span></span>
<span><span class="co">#&gt; 2         56732</span></span>
<span><span class="co">#&gt; 3         72785</span></span>
<span><span class="co">#&gt; 4         58664</span></span>
<span><span class="co">#&gt; 5         43788</span></span>
<span><span class="co">#&gt; 6         44120</span></span>
<span><span class="co">#&gt; 7         49153</span></span>
<span><span class="co">#&gt; 8         69674</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="long-strings-strl-and-binary-data">Long Strings (strL) and Binary Data<a class="anchor" aria-label="anchor" href="#long-strings-strl-and-binary-data"></a>
</h3>
<p>Stata 13 introduced “long strings” (<code>strL</code>), capable of
storing very large text values. These are stored separately from the
main data matrix in the dta file, with only a reference kept in the data
part. <code>readstata13</code> handles these; by default, they are read
into R character vectors.</p>
<p>Interestingly, Stata also allows embedding binary data (like images,
audio, or other files) within <code>strL</code> variables.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;A Stata blog post illustrates this feature, showing how
physicians could store X-ray images alongside patient data: &lt;a href="https://www.stata.com/stata-news/news31-4/spotlight/" class="external-link"&gt;“In the
spotlight: Storing long strings and entire files in Stata
datasets”&lt;/a&gt;.&lt;/p&gt;'><sup>5</sup></a> While R’s standard
data structures aren’t ideal for directly handling such embedded binary
data within a data frame,<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The challenge lies in R’s vector types; standard
character vectors aren’t designed for arbitrary binary data, and there’s
no native vector type for image processing or other binary formats
within a data frame context. This also means &lt;code&gt;readstata13&lt;/code&gt;
currently cannot create dta files &lt;em&gt;with&lt;/em&gt; embedded binary data
from R.&lt;/p&gt;"><sup>6</sup></a> <code>readstata13</code> version
<code>0.9.1</code> and later provides the <code>strlexport</code> option
to extract these binary contents to files.</p>
<p>Using <code>strlexport = TRUE</code> and specifying a path with
<code>strlpath</code>, you can save the contents of <code>strL</code>
variables as separate files in a designated directory.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a directory for exporting strLs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"res/strls/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read a dta file containing strLs and export their content</span></span>
<span><span class="va">dat_strl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="st">"stata_strl.dta"</span>, </span>
<span>                       strlexport <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                       strlpath <span class="op">=</span> <span class="st">"res/strls/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># List the files created in the export directory.</span></span>
<span><span class="co"># The filenames indicate the variable and observation index (e.g., 15_1).</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="st">"res/strls/"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "15_1" "16_1"</span></span></code></pre></div>
<p>The exported files do not have extensions because the file type is
not inherently known from the <code>strL</code> data itself (and could
vary cell by cell). The user is responsible for determining the correct
file type and processing the content. In this example, the first
exported file (<code>15_1</code>) is a text file.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read the content of the text file strL export</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">"res/strls/15_1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "R is a free software environment for statistical computing and graphics. It compiles and runs on a wide variety of UNIX platforms, Windows and MacOS. To download R, please choose your preferred CRAN mirror."</span></span>
<span><span class="co">#&gt; [2] ""                                                                                                                                                                                                              </span></span>
<span><span class="co">#&gt; [3] "If you have questions about R like how to download and install the software, or what the license terms are, please read our answers to frequently asked questions before you send an email."                   </span></span>
<span><span class="co">#&gt; [4] ""</span></span></code></pre></div>
<p>The second file (<code>16_1</code>) is a PNG image. You can read and
display it using appropriate R packages like <code>png</code> and
<code>grid</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.rforge.net/png/" class="external-link">png</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span> <span class="co"># grid is needed for grid.raster</span></span>
<span></span>
<span><span class="co"># Read the PNG image file</span></span>
<span><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/png/man/readPNG.html" class="external-link">readPNG</a></span><span class="op">(</span><span class="st">"res/strls/16_1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the image</span></span>
<span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.raster.html" class="external-link">grid.raster</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></span></code></pre></div>
<p><img src="readstata13_basic_manual_files/figure-html/unnamed-chunk-23-1.png" alt="Display of the R logo extracted from a long string." width="700"></p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jan Marvin Garbuszus, Sebastian Jeworutzki.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
